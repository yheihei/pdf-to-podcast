# FR-4,FR-5,FR-6,FR-7,FR-8 実装計画

## 概要
PDFポッドキャスト生成ツールのファイル出力、チャプタータグ、並列処理、再実行制御、ログ機能を実装する。

## 実装対象機能

### FR-4: ファイル出力
- 章ごとのテキストファイル (`01_Intro.txt`)
- 章ごとの音声ファイル (`01_Intro.mp3`)
- 全章連結した`episode.mp3`
- 進行状況を管理する`manifest.json`

### FR-5: チャプタータグ
- `episode.mp3`にID3v2 `CHAP`/`CTOC`タグを埋め込み
- 再生アプリでのチャプタースキップ対応

### FR-6: 並列処理
- 章単位でのGemini Text → TTS非同期実行
- `--max-concurrency`オプションでの並列数制御

### FR-7: 再実行制御
- `--skip-existing`オプションで既存ファイルスキップ
- 効率的な部分実行対応

### FR-8: ログ
- `rich`ライブラリでのリッチな出力
- `tqdm`でのプログレスバー表示
- 詳細ログを`logs/tool.log`に出力

## 実装タスク

### 1. 新しいモジュール作成
- [ ] `audio_mixer.py`: 音声連結・BGM処理・正規化
- [ ] `id3_tags.py`: ID3v2 CHAP/CTOCタグ付与
- [ ] `manifest.py`: 進行状況メタデータ管理
- [ ] `__main__.py`: CLIエントリーポイント

### 2. 既存モジュール拡張
- [ ] `tts_client.py`: 並列処理・スキップ機能追加
- [ ] `script_builder.py`: テキストファイル出力機能

### 3. 依存関係追加
- [ ] `requirements.txt`に必要ライブラリ追加:
  - `pydub`: 音声処理
  - `mutagen`: ID3タグ操作
  - `rich`: リッチな出力
  - `tqdm`: プログレスバー
  - `asyncio`: 非同期処理

### 4. CLIインターフェース
- [ ] コマンドライン引数パーサー
- [ ] 設定値の検証とデフォルト値
- [ ] エラーハンドリング

### 5. テスト
- [ ] 各モジュールの単体テスト
- [ ] 統合テスト
- [ ] エラーケーステスト

## 実装順序
1. 依存関係とマニフェスト管理
2. 音声処理とID3タグ
3. 並列処理とスキップ機能
4. ログシステム
5. CLIインターフェース
6. テストとデバッグ